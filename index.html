<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-ZONE SUPREME | 2026</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Plus+Jakarta+Sans:wght@300;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* ============================================================
           PROFESSIONAL UI DESIGN SYSTEM
           ============================================================ */
        :root {
            --gold: #FFD700; --bg: #050505; --card: #121212;
            --glass: rgba(255, 255, 255, 0.07); --border: rgba(255, 215, 0, 0.25);
            --text-main: #FFFFFF; --text-sub: #B0B0B0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }

        /* HEADER */
        header {
            position: fixed; top: 0; width: 100%; height: 80px; 
            background: rgba(5,5,5,0.8); backdrop-filter: blur(30px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; border-bottom: 1px solid var(--border); z-index: 1000;
        }
        .logo { font-family: 'Orbitron', sans-serif; font-size: 26px; color: var(--gold); font-weight: 900; }

        /* MAIN GRID */
        .content-area { padding: 100px 15px 100px; }
        .m-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(165px, 1fr)); gap: 18px; }
        .m-card { 
            background: var(--card); border-radius: 22px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); transition: 0.4s ease;
        }
        .m-card:hover { transform: translateY(-10px) scale(1.02); border-color: var(--gold); }
        .m-card img { width: 100%; height: 250px; object-fit: cover; }
        .m-card-meta { position: absolute; bottom: 0; width: 100%; padding: 30px 10px 15px; background: linear-gradient(to top, #000 70%, transparent); text-align: center; }
        .m-card-meta h4 { font-size: 14px; font-weight: 700; color: var(--gold); }

        /* NEW CINEMATIC DETAIL VIEW */
        .full-page { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 2000; overflow-y: auto; }
        .banner-wrap { width: 100%; height: 460px; position: relative; }
        .banner-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.5; }
        .banner-gradient { position: absolute; inset: 0; background: linear-gradient(to bottom, transparent, var(--bg)); }
        .poster-float { 
            width: 170px; height: 250px; border-radius: 20px; border: 4px solid var(--gold);
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            box-shadow: 0 25px 50px rgba(0,0,0,0.9);
        }

        .meta-body { padding: 30px 20px; text-align: center; }
        .btn-action-group { display: flex; gap: 15px; margin: 25px 0; }
        .btn-prime { flex: 1; height: 60px; background: var(--gold); color: #000; border: none; border-radius: 18px; font-weight: 900; font-size: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-sec { width: 60px; height: 60px; background: var(--glass); border-radius: 18px; border: 1px solid var(--border); color: #fff; display: flex; align-items: center; justify-content: center; }

        /* CHAPTERS */
        .ch-card { background: var(--card); padding: 22px; border-radius: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border-right: 5px solid var(--gold); }
        .ch-title { font-weight: 800; font-size: 16px; letter-spacing: 1px; }

        /* PROFILE EDITOR (FIXED) */
        .profile-container { padding: 100px 20px; text-align: center; }
        .avatar-main { width: 130px; height: 130px; border-radius: 50%; border: 4px solid var(--gold); background: #1a1a1a; padding: 5px; margin-bottom: 20px; transition: 0.3s; }
        .avatar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 20px; background: var(--card); border-radius: 25px; margin: 20px 0; border: 1px solid var(--border); }
        .avatar-item { width: 100%; border-radius: 50%; border: 2px solid transparent; transition: 0.2s; }
        .avatar-item.active { border-color: var(--gold); transform: scale(1.1); background: rgba(255,215,0,0.1); }

        /* ADMIN & CLOUDINARY */
        .form-group { background: var(--card); padding: 30px; border-radius: 25px; border: 1px solid var(--border); margin-bottom: 25px; }
        input, select { width: 100%; padding: 18px; background: #000; border: 1px solid #333; color: #fff; border-radius: 15px; margin-bottom: 15px; outline: none; font-size: 14px; }
        .upload-area { border: 2px dashed #444; padding: 50px 20px; border-radius: 20px; text-align: center; color: var(--text-sub); position: relative; cursor: pointer; }
        .upload-area:hover { border-color: var(--gold); color: #fff; }

        /* NAVIGATION BAR */
        .navbar { position: fixed; bottom: 0; width: 100%; height: 80px; background: #080808; border-top: 1px solid rgba(255,215,0,0.1); display: grid; grid-template-columns: repeat(4, 1fr); z-index: 1500; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-sub); font-size: 11px; gap: 6px; }
        .nav-item.active { color: var(--gold); }
        .nav-item i { font-size: 24px; }

        /* READER */
        .manga-reader img { width: 100%; display: block; border-bottom: 2px solid #000; }
    </style>
</head>
<body>

    <header>
        <div class="logo">M-ZONE</div>
        <div style="display:flex; gap:15px; align-items:center;">
            <div style="color:var(--gold); font-weight:900; font-size:15px;"><i class="fa-solid fa-bolt"></i> <span id="coinVal">0</span></div>
            <img id="navAv" onclick="openProfile()" src="" style="width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); cursor:pointer;">
        </div>
    </header>

    <div id="homePage" class="content-area">
        <div class="m-grid" id="mainDisplay"></div>
    </div>

    <div id="dp" class="full-page">
        <div style="position:fixed; top:25px; left:20px; z-index:3000; color:var(--gold);" onclick="clP()"><i class="fa-solid fa-circle-chevron-left fa-3xl"></i></div>
        <div class="banner-wrap">
            <img id="dtBanner" class="banner-img" src="">
            <div class="banner-gradient"></div>
            <img id="dtPoster" class="poster-float" src="">
        </div>
        <div class="meta-body">
            <h1 id="dtTitle" style="font-family:'Orbitron'; font-size:32px; letter-spacing:1px;"></h1>
            <div class="btn-action-group">
                <button class="btn-prime" id="bmButton" onclick="handleBookmark()"><i class="fa-solid fa-bookmark"></i> ADD TO LIBRARY</button>
                <div class="btn-sec" onclick="alert('Shared!')"><i class="fa-solid fa-share-nodes fa-xl"></i></div>
            </div>
            <div id="chapterList" style="text-align:left;"></div>
        </div>
    </div>

    <div id="profilePage" class="full-page">
        <div style="position:fixed; top:25px; left:20px; z-index:3000; color:var(--gold);" onclick="clP()"><i class="fa-solid fa-xmark fa-3xl"></i></div>
        <div class="profile-container">
            <img id="profAv" class="avatar-main" src="">
            <h2 id="dispName" style="font-family:'Orbitron';">GUEST USER</h2>
            <p style="color:var(--gold); font-size:12px; margin-top:5px;">PREMIUM COLLECTOR</p>

            <div style="margin-top:40px; text-align:left;">
                <h4 style="color:var(--gold); margin-left:10px;">CUSTOMIZE PROFILE</h4>
                <div class="avatar-grid" id="avGrid"></div>
                <input id="nickInput" placeholder="Change Nickname" style="margin-top:10px;">
                <button class="btn-prime" style="width:100%;" onclick="saveProfile()">UPDATE PROFILE</button>
            </div>

            <div class="form-group" style="margin-top:20px; text-align:left;">
                <h4>ACCOUNT ACCESS</h4>
                <input id="uLogin" type="email" placeholder="Email for Login">
                <button class="btn-prime" style="width:100%; background:#222; color:#fff;" onclick="doAuth()">LOGIN SYSTEM</button>
            </div>
            
            <button class="btn-prime" style="width:100%; background:#111; border:1px solid #333;" onclick="secureStaff()">STAFF ACCESS</button>
        </div>
    </div>

    <div id="libPage" class="full-page">
        <div class="content-area">
            <h2 style="font-family:'Orbitron'; color:var(--gold); margin-bottom:25px;">LIBRARY</h2>
            <div class="m-grid" id="libDisplay"></div>
        </div>
    </div>

    <div id="staffPanel" class="full-page">
        <div style="position:fixed; top:25px; left:20px; z-index:3000; color:var(--gold);" onclick="clP()"><i class="fa-solid fa-arrow-left fa-3xl"></i></div>
        <div style="padding:100px 15px;">
            <div class="form-group">
                <h2 style="font-family:'Orbitron'; color:var(--gold); margin-bottom:25px;">CLOUD PUBLISHING</h2>
                <select id="admCol"><option value="chapters">Manga Series</option><option value="animes">Anime Project</option></select>
                <input id="admName" placeholder="Series Title">
                <input id="admCh" type="number" placeholder="Chapter No.">
                <input id="admPrice" type="number" placeholder="Coin Price">
                
                <div class="upload-area" onclick="document.getElementById('fC').click()">
                    <p id="lC">Upload Main Poster</p>
                    <input type="file" id="fC" hidden onchange="document.getElementById('lC').innerText='Ready: '+this.files[0].name">
                </div>
                
                <div class="upload-area" style="margin-top:15px;" onclick="document.getElementById('fP').click()">
                    <p id="lP">Upload Manga Pages (Batch)</p>
                    <input type="file" id="fP" multiple hidden onchange="document.getElementById('lP').innerText=this.files.length+' Files Ready'">
                </div>
                
                <button class="btn-prime" style="width:100%; margin-top:20px;" id="upBtn" onclick="runCloudinaryPublish()">PUBLISH TO M-ZONE</button>
            </div>
        </div>
    </div>

    <div id="readerPage" class="full-page" style="background:#000;">
        <div style="position:fixed; top:25px; right:20px; z-index:3000; color:var(--gold);" onclick="clP()"><i class="fa-solid fa-xmark fa-3xl"></i></div>
        <div id="mangaContent" class="manga-reader"></div>
    </div>

    <div class="navbar">
        <div class="nav-item active" onclick="location.reload()"><i class="fa-solid fa-house"></i><span>Home</span></div>
        <div class="nav-item" onclick="nav('libPage')"><i class="fa-solid fa-bookmark"></i><span>Library</span></div>
        <div class="nav-item" onclick="alert('Exploration Mode: COMING SOON')"><i class="fa-solid fa-compass"></i><span>Explore</span></div>
        <div class="nav-item" onclick="openProfile()"><i class="fa-solid fa-user-gear"></i><span>Profile</span></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, query, where, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQlYCcHLrUoyjLGzk9hjrQUAE_q5fLWHs",
            authDomain: "mangabyax.firebaseapp.com", projectId: "mangabyax",
            storageBucket: "mangabyax.appspot.com", appId: "1:974159756281:web:228c23b929f377544b1b28"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // CLOUDINARY HARD-CODED (FOR YOU)
        const CLOUD_NAME = "drtm5p6qc";
        const UPLOAD_PRESET = "mzone_preset";

        let DATABASE = [];
        let COINS = parseInt(localStorage.getItem('m_coins') || "500");
        let USER_ID = localStorage.getItem('m_user') || null;
        let NICKNAME = localStorage.getItem('m_nick') || "Guest User";
        let AVATAR_SEED = localStorage.getItem('m_avatar') || "Felix";
        let MY_LIB = JSON.parse(localStorage.getItem('m_library') || "[]");

        // NAVIGATION
        window.nav = id => { document.getElementById(id).style.display='block'; history.pushState({p:id},"","#"+id); };
        window.clP = () => history.back();
        window.onpopstate = () => document.querySelectorAll('.full-page').forEach(p=>p.style.display='none');

        // INITIALIZE
        async function bootSystem() {
            const [m, a] = await Promise.all([getDocs(collection(db, "chapters")), getDocs(collection(db, "animes"))]);
            DATABASE = [...m.docs.map(d=>({id:d.id, ...d.data(), type:'Manga'})), ...a.docs.map(d=>({id:d.id, ...d.data(), type:'Anime'}))];
            
            drawGrid('mainDisplay', DATABASE);
            drawGrid('libDisplay', DATABASE.filter(d => MY_LIB.includes(d.seriesName)));
            refreshUI();
        }

        function drawGrid(targetId, items) {
            const el = document.getElementById(targetId);
            const unique = {};
            items.forEach(i => { if(i.seriesName) unique[i.seriesName] = i; });
            el.innerHTML = Object.values(unique).map(v => `
                <div class="m-card" onclick="openSeries('${v.seriesName.replace(/'/g, "\\'")}')">
                    <img src="${v.coverUrl}" loading="lazy">
                    <div class="m-card-meta"><h4>${v.seriesName}</h4></div>
                </div>
            `).join('');
        }

        window.openSeries = (title) => {
            const data = DATABASE.filter(d => d.seriesName === title);
            document.getElementById('dtBanner').src = data[0].coverUrl;
            document.getElementById('dtPoster').src = data[0].coverUrl;
            document.getElementById('dtTitle').innerText = title;
            
            document.getElementById('chapterList').innerHTML = data.sort((a,b)=>a.chapterNo-b.chapterNo).map(ch => `
                <div class="ch-card" onclick="unlockContent('${ch.id}', ${ch.price})">
                    <span class="ch-title">EPISODE ${ch.chapterNo}</span>
                    <span style="color:var(--gold); font-weight:800;">${ch.price > 0 ? ch.price + ' C' : 'FREE'}</span>
                </div>
            `).join('');
            
            const btn = document.getElementById('bmButton');
            btn.innerHTML = MY_LIB.includes(title) ? '<i class="fa-solid fa-check"></i> IN LIBRARY' : '<i class="fa-solid fa-bookmark"></i> ADD TO LIBRARY';
            nav('dp');
        };

        window.unlockContent = (id, price) => {
            if(!USER_ID) return openProfile();
            if(COINS < price) return alert("Not Enough Coins!");
            
            if(price > 0 && confirm(`Confirm ${price} Coins?`)) { COINS -= price; refreshUI(); }
            
            const target = DATABASE.find(d => d.id === id);
            const view = document.getElementById('mangaContent');
            view.innerHTML = target.pages.map(p => `<img src="${p}" loading="lazy">`).join('');
            nav('readerPage');
        };

        // PROFILE LOGIC
        window.openProfile = () => {
            document.getElementById('dispName').innerText = NICKNAME;
            document.getElementById('navAv').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${AVATAR_SEED}`;
            document.getElementById('profAv').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${AVATAR_SEED}`;
            
            const seeds = ["Felix", "Aria", "Jack", "Luna", "Milo", "Zoe", "Leo", "Nova", "Jasper", "Ruby", "Shadow", "King"];
            document.getElementById('avGrid').innerHTML = seeds.map(s => `
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${s}" class="avatar-item ${AVATAR_SEED === s ? 'active' : ''}" onclick="changeSeed('${s}')">
            `).join('');
            nav('profilePage');
        };

        window.changeSeed = (s) => { AVATAR_SEED = s; openProfile(); };
        
        window.saveProfile = () => {
            const newNick = document.getElementById('nickInput').value;
            if(newNick) NICKNAME = newNick;
            localStorage.setItem('m_nick', NICKNAME);
            localStorage.setItem('m_avatar', AVATAR_SEED);
            alert("Profile Synchronized!");
            openProfile();
        };

        window.doAuth = () => {
            const mail = document.getElementById('uLogin').value;
            if(mail.includes('@')) { USER_ID = mail; localStorage.setItem('m_user', mail); openProfile(); }
        };

        // CLOUDINARY ENGINE
        window.runCloudinaryPublish = async () => {
            const btn = document.getElementById('upBtn');
            btn.innerText = "UPLOADING TO CLOUD..."; btn.disabled = true;

            try {
                const cFile = document.getElementById('fC').files[0];
                const pFiles = document.getElementById('fP').files;
                
                const cUrl = await cloudUpload(cFile);
                const pUrls = [];
                for(let f of pFiles) {
                    pUrls.push(await cloudUpload(f));
                    btn.innerText = `SYNCING PAGES: ${pUrls.length}/${pFiles.length}`;
                }
                
                await addDoc(collection(db, document.getElementById('admCol').value), {
                    seriesName: document.getElementById('admName').value,
                    chapterNo: parseInt(document.getElementById('admCh').value),
                    price: parseInt(document.getElementById('admPrice').value || 0),
                    coverUrl: cUrl, pages: pUrls, stamp: Date.now()
                });
                
                alert("Published Successfully!"); location.reload();
            } catch (e) { alert(e.message); btn.innerText = "PUBLISH TO M-ZONE"; btn.disabled = false; }
        };

        async function cloudUpload(file) {
            const fd = new FormData();
            fd.append("file", file);
            fd.append("upload_preset", UPLOAD_PRESET);
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: "POST", body: fd });
            const d = await res.json();
            return d.secure_url;
        }

        // UTILS
        window.handleBookmark = () => {
            const t = document.getElementById('dtTitle').innerText;
            if(MY_LIB.includes(t)) MY_LIB = MY_LIB.filter(x => x !== t);
            else MY_LIB.push(t);
            localStorage.setItem('m_library', JSON.stringify(MY_LIB));
            openSeries(t);
            drawGrid('libDisplay', DATABASE.filter(d => MY_LIB.includes(d.seriesName)));
        };

        window.secureStaff = () => { if(prompt("STAFF KEY:") === "Admin@2026") nav('staffPanel'); };
        
        function refreshUI() {
            document.getElementById('coinVal').innerText = COINS;
            document.getElementById('navAv').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${AVATAR_SEED}`;
            localStorage.setItem('m_coins', COINS);
        }

        bootSystem();
    </script>
</body>
                </html>
