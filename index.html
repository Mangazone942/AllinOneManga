<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-ZONE V5 | PRO-ICONS</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --p: #FFD700; --b: #050505; --g: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--b); color: #fff; padding-top: 135px; }
        header { position: fixed; top: 0; width: 100%; z-index: 1000; background: rgba(5,5,5,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--g); padding: 15px 20px; }
        .search-bar { background: var(--g); border-radius: 12px; display: flex; align-items: center; padding: 0 15px; margin-top: 12px; }
        .search-bar i { opacity: 0.5; font-size: 14px; }
        .search-bar input { background: 0; border: 0; color: #fff; width: 100%; outline: 0; padding: 12px; font-size: 14px; }
        .slider { width: 92%; height: 200px; margin: 0 auto 20px; border-radius: 20px; overflow: hidden; position: relative; border: 1px solid var(--g); }
        .track { display: flex; transition: 0.7s; height: 100%; }
        .slide { min-width: 100%; position: relative; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 0 15px 100px; }
        .card { background: #111; border-radius: 18px; overflow: hidden; border: 1px solid var(--g); position: relative; }
        .card img { width: 100%; height: 240px; object-fit: cover; }
        .sidebar { position: fixed; top: 0; right: -310px; width: 300px; height: 100%; background: #080808; z-index: 2001; padding: 25px; transition: 0.4s; border-left: 1px solid var(--g); }
        .sidebar.active { right: 0; }
        .page { display: none; position: fixed; inset: 0; background: var(--b); z-index: 4000; overflow-y: auto; padding: 20px; }
        .btn-p { background: var(--p); color: #000; border: 0; padding: 14px; border-radius: 12px; font-weight: 700; width: 100%; cursor: pointer; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; background: #151515; border: 1px solid var(--g); color: #fff; border-radius: 10px; }
        #chatMsgs { height: 160px; overflow-y: auto; font-size: 11px; padding: 10px; border: 1px solid var(--g); border-radius: 10px; margin: 15px 0; background: #000; }
        @media (min-width: 600px) { .grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); } .slider { height: 350px; } }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <b style="font-size:24px; color:var(--p); letter-spacing:1px;" onclick="location.reload()">M-ZONE <i class="fa-solid fa-bolt"></i></b>
            <div style="display:flex; gap:20px; align-items:center;">
                <i class="fa-solid fa-ranking-star" onclick="shL()" style="color:var(--p); font-size:20px"></i>
                <i class="fa-solid fa-bars-staggered" onclick="tgS()" style="font-size:24px"></i>
            </div>
        </div>
        <div class="search-bar"><i class="fa-solid fa-magnifying-glass"></i><input id="q" placeholder="Search titles..." oninput="sh()"></div>
    </header>

    <div class="sidebar" id="sb">
        <div id="uC" style="display:none; background:linear-gradient(135deg, #1a1a1a, #000); padding:18px; border-radius:15px; border:1px solid var(--g)">
            <b id="uN" style="font-size:18px"></b><br>
            <small style="color:var(--p)"><i class="fa-solid fa-coins"></i> Gold: <span id="uG">0</span></small>
            <div style="display:flex; gap:5px; margin-top:12px;"><input id="vk" placeholder="VIP Key" style="margin:0; font-size:11px;"><button onclick="rk()" style="background:var(--p); border:0; padding:10px; border-radius:8px"><i class="fa-solid fa-check"></i></button></div>
        </div>
        <button id="lb" class="btn-p" onclick="tgM('am')"><i class="fa-solid fa-user-plus"></i> GET STARTED</button>
        <div id="chatMsgs"></div>
        <div style="display:flex; gap:5px"><input id="ci" placeholder="Chat here..." style="margin:0; font-size:12px;"><button onclick="sc()" style="background:var(--p); border:0; width:45px; border-radius:10px"><i class="fa-solid fa-paper-plane"></i></button></div>
        <nav style="margin-top:25px; display:flex; flex-direction:column; gap:20px; font-weight:600; font-size:14px">
            <p onclick="sB()" style="cursor:pointer"><i class="fa-solid fa-heart" style="color:#ff4757; margin-right:12px"></i> My Library</p>
            <p onclick="fT('Anime')" style="cursor:pointer"><i class="fa-solid fa-circle-play" style="color:var(--p); margin-right:12px"></i> H-Anime</p>
            <p onclick="cA()" style="opacity:0.2; font-size:10px; cursor:pointer"><i class="fa-solid fa-user-shield"></i> STAFF PANEL</p>
        </nav>
    </div>

    <div class="slider"><div class="track" id="st"></div></div>
    <div id="mg" class="grid"></div>

    <div id="dp" class="page">
        <i class="fa-solid fa-chevron-left" onclick="clP('dp')" style="font-size:24px; color:var(--p)"></i>
        <div id="dh" style="margin-top:20px"></div>
        <div id="cl" style="margin-top:25px"></div>
    </div>

    <div id="vp" class="page" style="padding:0">
        <div style="padding:15px; background:rgba(0,0,0,0.9); display:flex; justify-content:space-between; position:sticky; top:0; z-index:10">
            <i class="fa-solid fa-xmark" onclick="clP('vp')"></i><span id="vt" style="font-size:13px; font-weight:700"></span><i class="fa-solid fa-heart" onclick="tB()"></i>
        </div>
        <div id="vc"></div>
    </div>

    <script type="module">
        // ... (အရင်က Firebase Logic တွေအတိုင်းပဲ အလုပ်လုပ်မယ်၊ Icon တွေပဲ နေရာတကျ ပြင်ဆင်ထားတာပါ)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc, setDoc, updateDoc, addDoc, serverTimestamp, query, orderBy, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const cfg = { apiKey: "AIzaSyDQlYCcHLrUoyjLGzk9hjrQUAE_q5fLWHs", authDomain: "mangabyax.firebaseapp.com", projectId: "mangabyax", storageBucket: "mangabyax.firebasestorage.app", appId: "1:974159756281:web:228c23b929f377544b1b28" };
        const app = initializeApp(cfg), db = getFirestore(app), auth = getAuth(app);
        let u = null, ad = [], cur = "";

        // UI Helpers
        window.tgS = () => document.getElementById('sb').classList.toggle('active');
        window.clP = (id) => document.getElementById(id).style.display='none';
        window.tgM = (id) => { const m=document.getElementById(id); m.style.display=m.style.display==='none'?'flex':'none'; };

        onAuthStateChanged(auth, async (user) => {
            if(user) { u = user; const dS = await getDoc(doc(db,"users",u.uid)); if(!dS.exists()) await setDoc(doc(db,"users",u.uid),{coins:0,bookmarks:[]});
                document.getElementById('uC').style.display='block'; document.getElementById('lb').style.display='none';
                document.getElementById('uN').innerText = u.email.split('@')[0].toUpperCase(); ug(); lc();
            }
        });

        async function ug() { const d=await getDoc(doc(db,"users",u.uid)); document.getElementById('uG').innerText=d.data().coins; }
        
        async function ld() {
            const m = await getDocs(query(collection(db,"chapters"),orderBy("timestamp","desc")));
            ad = m.docs.map(d=>({id:d.id,...d.data()}));
            rh(ad); rs(ad.slice(0,5));
        }

        function rh(data) {
            const un = {}; data.forEach(i => { if(!un[i.seriesName]) un[i.seriesName] = i; });
            document.getElementById('mg').innerHTML = Object.values(un).map(v => `
                <div class="card" onclick="oD('${v.seriesName.replace(/'/g,"\\'")}')">
                    <img src="${v.coverUrl}"><div style="padding:12px; font-size:12px; font-weight:600; text-align:center">${v.seriesName}</div>
                </div>`).join('');
        }

        window.sh = () => { const q=document.getElementById('q').value.toLowerCase(); rh(ad.filter(i=>i.seriesName.toLowerCase().includes(q))); };
        
        window.oD = (n) => { cur=n; const it=ad.filter(i=>i.seriesName===n);
            document.getElementById('dh').innerHTML = `<div style="display:flex; gap:15px"><img src="${it[0].coverUrl}" style="width:100px; border-radius:12px"><div><h3>${n}</h3><button onclick="tB()" class="btn-p" style="padding:8px 15px; font-size:10px; margin-top:10px">+ FAVORITE</button></div></div>`;
            document.getElementById('cl').innerHTML = it.map(c=>`<div onclick="rM('${c.id}')" style="padding:16px; background:var(--g); margin:10px 0; border-radius:12px; display:flex; justify-content:space-between"><span>Chapter ${c.chapterNum}</span><i class="fa-solid fa-lock" style="color:var(--p)"></i></div>`).join('');
            document.getElementById('dp').style.display='block';
        };

        window.rk = async () => { const k=document.getElementById('vk').value; const qS=await getDocs(query(collection(db,"keys"),where("key","==",k),where("used","==",false)));
            if(qS.empty) return alert("Invalid"); await updateDoc(doc(db,"users",u.uid),{coins:(await getDoc(doc(db,"users",u.uid))).data().coins+qS.docs[0].data().amount});
            await updateDoc(doc(db,"keys",qS.docs[0].id),{used:true}); location.reload();
        };

        window.sc = async () => { const m=document.getElementById('ci').value; if(m&&u){await addDoc(collection(db,"chats"),{name:u.email.split('@')[0],msg:m,timestamp:serverTimestamp()});document.getElementById('ci').value="";}};
        function lc() { onSnapshot(query(collection(db,"chats"),orderBy("timestamp","desc")),s=>document.getElementById('chatMsgs').innerHTML=s.docs.slice(0,15).map(d=>`<div><b>${d.data().name}:</b> ${d.data().msg}</div>`).reverse().join('')); }
        function rs(s) { document.getElementById('st').innerHTML=s.map(x=>`<div class="slide"><img src="${x.coverUrl}"></div>`).join(''); let i=0; setInterval(()=>{i=(i+1)%s.length; document.getElementById('st').style.transform=`translateX(-${i*100}%)`},4000); }
        
        ld();
    </script>
</body>
</html>
