<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MANGAZONE PRO - CLOUD EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #e62117; --bg: #050505; --card: #121212; --text: #fff; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); padding-top: 60px; }
        
        /* NAVIGATION */
        header { 
            background: var(--primary); height: 60px; width: 100%; position: fixed; top: 0; 
            z-index: 1000; display: flex; align-items: center; justify-content: space-between; 
            padding: 0 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); 
        }
        .logo { font-family: 'Oswald'; font-size: 24px; color: #fff; text-decoration: none; }
        .btn-top { background: rgba(0,0,0,0.3); border: 1px solid #fff; color: #fff; padding: 6px 15px; border-radius: 5px; font-size: 12px; cursor: pointer; font-weight: 600; }
        
        /* ADMIN PANEL UI */
        #adminBox { 
            display: none; background: var(--card); padding: 25px; border: 1px solid var(--primary); 
            margin: 15px; border-radius: 10px; animation: fadeIn 0.4s ease-out; 
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .admin-input { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: #fff; border-radius: 5px; }
        .btn-pub { background: var(--primary); color: #fff; border: none; width: 100%; padding: 14px; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-pub:disabled { background: #555; }

        /* HERO SECTION */
        .hero { 
            height: 350px; background: linear-gradient(to right, #000 40%, transparent), 
            url('https://image_2023-08-11_003823987.png.webp') center/cover; 
            display: flex; align-items: center; padding: 30px; 
        }
        .hero-content h4 { color: var(--primary); letter-spacing: 2px; font-size: 12px; }
        .hero-content h1 { font-family: 'Oswald'; font-size: 50px; line-height: 1.1; margin: 10px 0; }
        .hero-content p { font-size: 14px; color: #ccc; max-width: 400px; }

        /* MANGA GRID */
        .container { padding: 30px 15px; }
        .section-title { border-left: 5px solid var(--primary); padding-left: 12px; font-size: 22px; margin-bottom: 25px; font-family: 'Oswald'; }
        .manga-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .card { background: var(--card); border-radius: 12px; overflow: hidden; border: 1px solid #222; transition: 0.3s; }
        .card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(230,33,23,0.2); }
        .card img { width: 100%; height: 240px; object-fit: cover; background: #222; }
        .card-info { padding: 15px; text-align: center; }
        .card-info h3 { font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-info small { color: #777; font-size: 11px; }

        @media (min-width: 768px) { .manga-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); } }
    </style>
</head>
<body>

    <header>
        <a href="#" class="logo">MANGAZONE</a>
        <div style="display: flex; gap: 10px;">
            <button class="btn-top" onclick="toggleAdmin()">ADMIN PANEL</button>
            <button class="btn-top" style="background:white; color:red;">LOGIN</button>
        </div>
    </header>

    <div id="adminBox">
        <h2 style="color:var(--primary); font-family:'Oswald'; margin-bottom:10px;">Cloud Publisher</h2>
        <input type="text" id="mangaTitle" class="admin-input" placeholder="Enter Manga Title (e.g., Solo Leveling)">
        <p style="font-size: 12px; color: #888;">Select Cover Photo:</p>
        <input type="file" id="mangaFile" class="admin-input" accept="image/*">
        <button id="uploadBtn" class="btn-pub">PUBLISH TO M-ZONE</button>
    </div>

    <section class="hero">
        <div class="hero-content">
            <h4>FEATURED STORY</h4>
            <h1>VAGABOND</h1>
            <p>The epic journey of Miyamoto Musashi as he seeks the meaning of true strength through the sword.</p>
            <button class="btn-pub" style="width: auto; padding: 12px 30px; margin-top: 20px;">START READING</button>
        </div>
    </section>

    <div class="container">
        <h2 class="section-title">LATEST UPDATES</h2>
        <div id="manga-list" class="manga-grid">
            <p style="grid-column: span 2; text-align: center; color: #555;">Loading database...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURATIONS (All Connected)
        const firebaseConfig = {
            apiKey: "AIzaSyDQlYCcHLrUoyjLGzk9hjrQUAE_q5fLWHs",
            authDomain: "mangabyax.firebaseapp.com",
            projectId: "mangabyax",
            storageBucket: "mangabyax.appspot.com",
            appId: "1:974159756281:web:228c23b929f377544b1b28"
        };
        const CLOUD_NAME = "drtm5p6qc";
        const UPLOAD_PRESET = "mzone_preset";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // UI ACTIONS
        window.toggleAdmin = () => {
            const box = document.getElementById('adminBox');
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        };

        // FETCH DATA FROM FIREBASE
        async function fetchManga() {
            const list = document.getElementById('manga-list');
            try {
                const q = query(collection(db, "chapters"), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    list.innerHTML = "<p style='grid-column:span 2; text-align:center;'>No manga found in Cloud.</p>";
                    return;
                }

                list.innerHTML = querySnapshot.docs.map(doc => {
                    const data = doc.data();
                    return `
                        <div class="card">
                            <img src="${data.coverUrl}" onerror="this.src='https://via.placeholder.com/240x350?text=No+Image'">
                            <div class="card-info">
                                <h3>${data.title}</h3>
                                <small>ID: ${doc.id.substring(0,8)}</small>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (err) {
                console.error(err);
                list.innerHTML = "<p>Database Error. Check Console.</p>";
            }
        }

        // UPLOAD & LINKING LOGIC
        document.getElementById('uploadBtn').onclick = async () => {
            const titleInput = document.getElementById('mangaTitle');
            const fileInput = document.getElementById('mangaFile');
            const btn = document.getElementById('uploadBtn');

            if (!titleInput.value || !fileInput.files[0]) return alert("အချက်အလက် အကုန်ဖြည့်ပါ!");

            btn.innerText = "UPLOADING...";
            btn.disabled = true;

            try {
                // 1. Upload to Cloudinary
                const formData = new FormData();
                formData.append("file", fileInput.files[0]);
                formData.append("upload_preset", UPLOAD_PRESET);

                const cloudRes = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
                    method: "POST",
                    body: formData
                });

                if (!cloudRes.ok) throw new Error("Cloudinary Failed");

                const cloudData = await cloudRes.json();
                const cloudUrl = cloudData.secure_url;

                // 2. Store Link in Firebase
                await addDoc(collection(db, "chapters"), {
                    title: titleInput.value,
                    coverUrl: cloudUrl,
                    timestamp: serverTimestamp()
                });

                alert("Successfully Published!");
                location.reload();

            } catch (err) {
                console.error(err);
                alert("Fail: " + err.message);
                btn.innerText = "PUBLISH TO M-ZONE";
                btn.disabled = false;
            }
        };

        fetchManga();
    </script>
</body>
</html>
